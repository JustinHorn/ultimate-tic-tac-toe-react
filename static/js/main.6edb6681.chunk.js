(this["webpackJsonpultimate-tic-tac-toe"]=this["webpackJsonpultimate-tic-tac-toe"]||[]).push([[0],{172:function(e,t,a){e.exports=a(301)},177:function(e,t,a){},301:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(40),l=a.n(i),c=(a(177),a(18)),o=a(19),s=a(21),u=a(22),h=a(23),m=a(33),d=a(302),f=a(309),v=a(310),p=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(c.a)(this,a);var r=(n=t.call(this,e)).props.defaultValues;return n.state={boardSize:3,clock:r.clock,time:r.time},n.handleChange=n.handleChange.bind(Object(s.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(s.a)(n)),n}return Object(o.a)(a,[{key:"handleChange",value:function(e){var t=e.target;this.handleTarget(t)}},{key:"handleTarget",value:function(e){var t="checkbox"===e.type?e.checked:e.value,a=e.name;"clock"===a&&console.log("Clock: "+e.value),this.setState(Object(m.a)({},a,t))}},{key:"handleSubmit",value:function(e){this.props.submitCallback(this.state.clock,this.state.time),e.preventDefault()}},{key:"render",value:function(){var e=this;return r.a.createElement("form",null,r.a.createElement(d.a,{size:"mini",onClick:this.handleSubmit}," ","new Game"),r.a.createElement("label",{className:"settings-label"},r.a.createElement(f.a,{label:"Clock",name:"clock",type:"checkbox",onChange:function(t,a){return e.handleTarget(a)}})),this.state.clock&&r.a.createElement("label",{className:"settings-label"},r.a.createElement(v.a,{label:"Time (min)",size:"mini",name:"time",type:"number",max:"100",min:"1",value:this.state.time,onChange:this.handleChange})))}}]),a}(r.a.Component),k=a(36),y="#fc7341",b="#2db2e2",g="#ffccb5",w="#dbf5ff",O="#F0F8FF",x="#e2ffec";function E(e){var t={display:"inline-block"};return e.value&&(t.color="X"===e.value?y:b),e.winner&&("X"===e.winner?t.background=g:"O"===e.winner?t.background=w:t.background=O),e.clickable&&(t.background=x),r.a.createElement("button",{className:"square",style:t,onClick:function(){e.clickable&&e.onClick()}},e.value)}function I(e,t,a){for(var n=[],i=0;i<t;i++){for(var l=[],c=0;c<t;c++)l.push(a(i*t+c));n.push(r.a.createElement("div",{className:e+"-row",key:i},l))}return r.a.createElement("div",{className:e},n)}var C=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).renderSquare=n.renderSquare.bind(Object(s.a)(n)),n}return Object(o.a)(a,[{key:"renderSquare",value:function(e){var t=this;return r.a.createElement(E,{key:e,value:this.props.squares[e],winner:this.props.winner,clickable:!this.props.squares[e]&&this.props.clickable,onClick:function(){return t.props.onClick(e)}})}},{key:"render",value:function(){return I("board",this.props.size,this.renderSquare)}}]),a}(r.a.Component);function j(e){var t,a=A.getMoves(e);return(t=a)[Math.floor(Math.random()*t.length)]}var A=function(){function e(){Object(c.a)(this,e)}return Object(o.a)(e,null,[{key:"getMoves",value:function(t){var a=[];return t.localWinners.forEach((function(n,r){null===n&&t.activeFields[r]&&t.squares[r].forEach((function(t,n){null===t&&a.push(e.getMove(n,r))}))})),a}},{key:"getNextData",value:function(t,a){if(void 0===t.xIsNext)throw Error("Data xIsNext is undefined");var n=t.squares.map((function(e){return e.slice()}));if(!a||n[a.outer_idx][a.inner_idx])throw console.log("hello"),Error("field already taken");if(!t.activeFields[a.outer_idx])throw Error("field inactive");n[a.outer_idx][a.inner_idx]=t.xIsNext?"X":"O";var r=n.map((function(t){return e.calc3x3(t)})),i=e.calc3x3(r),l=t.activeFields.slice();return r[a.inner_idx]?r.forEach((function(e,t){return l[t]=!e})):l=l.map((function(e,t){return t===a.inner_idx})),i&&(l=Array(9).fill(!1)),{winner:i,squares:n,localWinners:r,activeFields:l,xIsNext:!t.xIsNext}}},{key:"dataIsOver",value:function(t){return 0===e.getMoves(t).length}},{key:"propagate",value:function(t){var a=t.data;if(t.hasChildren())throw Error("Tree shouldn't have children");for(var n=e.calc3x3(a.localWinners);!e.dataIsOver(a);)n=(a=e.getNextData(a,j(a))).winner;return n?n===(t.data.xIsNext?"O":"X")?P.VICTORY:P.DEFEAT:P.DRAW}}]),e}();A.getMove=function(e,t){return{inner_idx:e,outer_idx:t}},A.calc3x3=function(e){for(var t=["XXX","OOO"],a=[(e=e.map((function(e){return e||" "})))[0]+e[1]+e[2],e[3]+e[4]+e[5],e[6]+e[7]+e[8],e[0]+e[3]+e[6],e[1]+e[4]+e[7],e[2]+e[5]+e[8],e[0]+e[4]+e[8],e[2]+e[4]+e[6]],n=0;n<a.length;n++)if(a[n]===t[0]||a[n]===t[1])return a[n].charAt(0);return null},A.calcWinner=function(e){return A.calc3x3(e.map((function(e){return A.calc3x3(e)})))};var P={VICTORY:1,DEFEAT:-1,DRAW:0},N=a(311),T={p1:"AI",p2:"AI",aiP1T:1,aiP2T:1},W={p1:"human",p2:"human",aiP1T:1,aiP2T:1},S=[{key:"h",value:"human",text:"human"},{key:"rAI",value:"rAI",text:"random AI"},{key:"a",value:"AI",text:"AI"}],D=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={players:e.props.players,callBackPlayer:e.props.callBackPlayer},e.handlePlayers=function(t){var a=t.target;e.handlePlayerTarget(a)},e.handlePlayerTarget=function(t,a){var n="checkbox"===a.type?a.checked:a.value,r=Object(k.a)({},e.state.players);r[t]=n,e.setState({players:r}),e.state.callBackPlayer&&e.state.callBackPlayer(r)},e}return Object(o.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null," ",r.a.createElement(N.a,{inline:!0,options:S,name:"p1",onChange:function(t,a){return e.handlePlayerTarget("p1",a)},defaultValue:this.state.players.p1})," ","vs."," ",r.a.createElement(N.a,{inline:!0,name:"p2",options:S,defaultValue:this.state.players.p2,onChange:function(t,a){return e.handlePlayerTarget("p2",a)}}),"AI"===this.state.players.p1&&r.a.createElement("label",{className:"settings-label"},r.a.createElement(v.a,{label:"AI player1 time (s)",size:"mini",name:"aiP1T",type:"number",min:"0.001",max:"9",value:this.state.players.aiP1T,onChange:function(t,a){return e.handlePlayerTarget("aiP1T",a)}})),"AI"===this.state.players.p2&&r.a.createElement("label",{className:"settings-label"},r.a.createElement(v.a,{label:"AI player2 time (s)",size:"mini",name:"aiP2T",min:"0.001",type:"number",max:"9",value:this.state.players.aiP2T,onChange:function(t,a){return e.handlePlayerTarget("aiP2T",a)}})))}}]),a}(n.Component),M=a(160),q=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={elapsed:0},n.tick=function(){n.setState((function(e,t){var a=new Date-n.lastTick,r=e.elapsed+a;return t.seconds-r/1e3<.15&&t.timeOverCallback(t.player),{elapsed:r}})),n.lastTick=new Date},n.lastTick=null,n}return Object(o.a)(a,[{key:"componentWillUnmount",value:function(){clearInterval(this.timer)}},{key:"pause",value:function(){clearInterval(this.timer),this.timer=null,this.lastTick=null}},{key:"resume",value:function(){this.timer=setInterval(this.tick,1e3),this.lastTick=new Date}},{key:"render",value:function(){var e=this.props.seconds-Math.floor(this.state.elapsed/1e3),t=Math.floor(e/60),a=e%60;return this.props.isPaused?this.pause():this.timer||this.resume(),r.a.createElement("p",{className:"countdown"},("0"+t).slice(-2),":",("0"+a).slice(-2))}}]),a}(r.a.Component);function F(e){return r.a.createElement("div",{className:"game-info"},r.a.createElement("div",{id:"status"},function(e){var t;e.winner?(t=e.winner+" wins!",null===A.calc3x3(e.localWinners)&&(t="Time over! "+t)):-1===e.localWinners.indexOf(null)?(t="Draw! Everybody wins!! :D",console.log(e)):t="Next player: "+(e.xIsNext?"X":"O");return t}(e.state)),e.clock&&function(e,t,a){var n=!a.xIsNext||Boolean(a.winner),i=a.xIsNext||Boolean(a.winner);return r.a.createElement("div",null,"[TIME] X:"," ",r.a.createElement(q,{key:1,player:"X",seconds:60*t,isPaused:n,timeOverCallback:e}),", O:"," ",r.a.createElement(q,{key:2,player:"O",seconds:60*t,isPaused:i,timeOverCallback:e}))}(e.timeOverCallback,e.time,e.state))}var X={squares:Array(9).fill(Array(9).fill(null)),localWinners:Array(9).fill(null),activeFields:Array(9).fill(!0),xIsNext:!0,winner:null,size:3},B=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state=Object(k.a)({},X),n.workerApi=void 0,n.workers=[0],n.getAIMove=function(e,t){n.removeWorkers(),n.getWorker();var a=function(t,a){if(n.noUpdateOccured(a)){if(!t)throw Error("move is undefined: "+t);e.handleClick(t)}},r=n.getIdWorkerId();if("rAI"===t)n.workerApi.getRandomMove(e.state).then((function(e){a(e,r)}));else if("AI"===t){var i=e.state.xIsNext?n.state.players.aiP1T:n.state.players.aiP2T;i*=1e3,n.workerApi.getMonteCarloMove(e.state,i).then((function(e){a(e,r)}))}},n.getIdWorkerId=function(){var e=n.workers[0]+1;return n.workers.push(e),n.workers[0]=e+1,e},n.noUpdateOccured=function(e){return-1!==n.workers.indexOf(e)},n.removeWorkers=function(){n.workers=[n.workers[0]]},n.getWorker=function(){if(!n.workerApi){var e=new Worker("./webworker",{name:"webworker",type:"module"});n.workerApi=Object(M.a)(e)}},n.getPlayer=function(){return n.players},n.setPlayer=function(e){n.setState({players:Object(k.a)({},e)}),n.props.onPlayerChange&&n.props.onPlayerChange(e)},n.handleClick=function(e){if(!n.state.winner){var t=A.getNextData(n.state,e);n.setState((function(e,a){return Object(k.a)({},t)}))}},n.renderBoard=function(e){return r.a.createElement(C,{key:e,size:3,squares:n.state.squares[e],winner:n.state.localWinners[e],clickable:n.state.activeFields[e],onClick:function(t){return n.handleClick(A.getMove(t,e))}})},n.handleAI=function(){var e=Object(s.a)(n).state;A.getMoves(e).length>0&&(e.xIsNext&&"human"!==e.players.p1?n.getAIMove(Object(s.a)(n),e.players.p1):e.xIsNext||"human"===e.players.p2||n.getAIMove(Object(s.a)(n),e.players.p2))},n.timeOver=function(e){"X"===e?n.setState({winner:"O"}):n.setState({winner:"X"})},e.players?n.state.players=e.players:n.state.players=W,n}return Object(o.a)(a,[{key:"render",value:function(){this.handleAI();var e=this.state;return r.a.createElement("div",null,r.a.createElement("div",{className:"Game-Settings"},r.a.createElement(D,{callBackPlayer:this.setPlayer,players:e.players})),r.a.createElement("div",{className:"game-container"},r.a.createElement("div",{className:"game-row"},r.a.createElement(_,{render:this.renderBoard}))),r.a.createElement("br",null),r.a.createElement("div",{className:"game-container"},this.props.renderInfo&&r.a.createElement(F,{clock:this.props.clock,timeOver:this.timeOver,time:this.props.time,state:e})))}}]),a}(n.Component);function _(e){return I("game",3,e.render)}var z=!1,R=10,G=function(e){Object(u.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).players=T,n.onPlayerChange=function(e){n.players=e},n.state={clock:z,time:R,matchID:0},n.newGame=n.newGame.bind(Object(s.a)(n)),n}return Object(o.a)(a,[{key:"newGame",value:function(e,t){this.setState((function(a,n){return{clock:e,time:t,matchID:a.matchID+1}}))}},{key:"updatePlayer",value:function(e){}},{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"container mt-2"},r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement(p,{defaultValues:this.state,submitCallback:this.newGame}),r.a.createElement("br",null)),r.a.createElement("div",{className:"row justify-content-center"},r.a.createElement(B,{key:this.state.matchID,clock:this.state.clock,time:this.state.time,players:this.players,onPlayerChange:this.onPlayerChange,renderInfo:!0}))))}}]),a}(r.a.Component),U=(a(300),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/)));function V(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}l.a.render(r.a.createElement(G,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/ultimate-tic-tac-toe-react",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/ultimate-tic-tac-toe-react","/service-worker.js");U?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):V(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):V(t,e)}))}}()}},[[172,1,2]]]);
//# sourceMappingURL=main.6edb6681.chunk.js.map